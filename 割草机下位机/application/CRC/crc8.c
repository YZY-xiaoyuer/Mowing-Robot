/**
  ******************************************************************************
  * @file    crc8.c
  * @author  WenXianlei
  * @version V0.0.1
  * @date    2017/8/11
  * @brief   宝乐割草机上下位机通信CRC校验
  ******************************************************************************        
*/

/* Includes ------------------------------------------------------------------*/
#include "user_header.h"
#include "crc8.h"


/* char型数据与0x07异或运算结果表格，MSB */
const uint8_t crc8Xor0x07Table[] = {
    0, 7, 14, 9, 28, 27, 18, 21, 56, 63, 54, 49, 36, 35, 42, 45, 112, 119, 126, 121, 108, 107, 98, 101, 72, 
    79, 70, 65, 84, 83, 90, 93, 224, 231, 238, 233, 252, 251, 242, 245, 216, 223, 214, 209, 196, 195, 202, 205, 144, 151, 
    158, 153, 140, 139, 130, 133, 168, 175, 166, 161, 180, 179, 186, 189, 199, 192, 201, 206, 219, 220, 213, 210, 255, 248, 241, 
    246, 227, 228, 237, 234, 183, 176, 185, 190, 171, 172, 165, 162, 143, 136, 129, 134, 147, 148, 157, 154, 39, 32, 41, 46, 
    59, 60, 53, 50, 31, 24, 17, 22, 3, 4, 13, 10, 87, 80, 89, 94, 75, 76, 69, 66, 111, 104, 97, 102, 115, 
    116, 125, 122, 137, 142, 135, 128, 149, 146, 155, 156, 177, 182, 191, 184, 173, 170, 163, 164, 249, 254, 247, 240, 229, 226, 
    235, 236, 193, 198, 207, 200, 221, 218, 211, 212, 105, 110, 103, 96, 117, 114, 123, 124, 81, 86, 95, 88, 77, 74, 67, 
    68, 25, 30, 23, 16, 5, 2, 11, 12, 33, 38, 47, 40, 61, 58, 51, 52, 78, 73, 64, 71, 82, 85, 92, 91, 
    118, 113, 120, 127, 106, 109, 100, 99, 62, 57, 48, 55, 34, 37, 44, 43, 6, 1, 8, 15, 26, 29, 20, 19, 174, 
    169, 160, 167, 178, 181, 188, 187, 150, 145, 152, 159, 138, 141, 132, 131, 222, 217, 208, 215, 194, 197, 204, 203, 230, 225, 
    232, 239, 250, 253, 244, 243
};


/* char型数据与0xE0异或运算结果表格，LSB */
const uint8_t crc8Xor0xe0Table[] = {
    0, 145, 227, 114, 7, 150, 228, 117, 14, 159, 237, 124, 9, 152, 234, 123, 28, 141, 255, 110, 27, 138, 248, 105, 18, 
    131, 241, 96, 21, 132, 246, 103, 56, 169, 219, 74, 63, 174, 220, 77, 54, 167, 213, 68, 49, 160, 210, 67, 36, 181, 
    199, 86, 35, 178, 192, 81, 42, 187, 201, 88, 45, 188, 206, 95, 112, 225, 147, 2, 119, 230, 148, 5, 126, 239, 157, 
    12, 121, 232, 154, 11, 108, 253, 143, 30, 107, 250, 136, 25, 98, 243, 129, 16, 101, 244, 134, 23, 72, 217, 171, 58, 
    79, 222, 172, 61, 70, 215, 165, 52, 65, 208, 162, 51, 84, 197, 183, 38, 83, 194, 176, 33, 90, 203, 185, 40, 93, 
    204, 190, 47, 224, 113, 3, 146, 231, 118, 4, 149, 238, 127, 13, 156, 233, 120, 10, 155, 252, 109, 31, 142, 251, 106, 
    24, 137, 242, 99, 17, 128, 245, 100, 22, 135, 216, 73, 59, 170, 223, 78, 60, 173, 214, 71, 53, 164, 209, 64, 50, 
    163, 196, 85, 39, 182, 195, 82, 32, 177, 202, 91, 41, 184, 205, 92, 46, 191, 144, 1, 115, 226, 151, 6, 116, 229, 
    158, 15, 125, 236, 153, 8, 122, 235, 140, 29, 111, 254, 139, 26, 104, 249, 130, 19, 97, 240, 133, 20, 102, 247, 168, 
    57, 75, 218, 175, 62, 76, 221, 166, 55, 69, 212, 161, 48, 66, 211, 180, 37, 87, 198, 179, 34, 80, 193, 186, 43, 
    89, 200, 189, 44, 94, 207
};


/* char型数据与0x8C异或运算结果表格，LSB */
const uint8_t crc8Xor0x8cTable[] = {
    0, 94, 188, 226, 97, 63, 221, 131, 194, 156, 126, 32, 163, 253, 31, 65, 157, 195, 33, 127, 252, 162, 64, 30, 95, 
    1, 227, 189, 62, 96, 130, 220, 35, 125, 159, 193, 66, 28, 254, 160, 225, 191, 93, 3, 128, 222, 60, 98, 190, 224, 
    2, 92, 223, 129, 99, 61, 124, 34, 192, 158, 29, 67, 161, 255, 70, 24, 250, 164, 39, 121, 155, 197, 132, 218, 56, 
    102, 229, 187, 89, 7, 219, 133, 103, 57, 186, 228, 6, 88, 25, 71, 165, 251, 120, 38, 196, 154, 101, 59, 217, 135, 
    4, 90, 184, 230, 167, 249, 27, 69, 198, 152, 122, 36, 248, 166, 68, 26, 153, 199, 37, 123, 58, 100, 134, 216, 91, 
    5, 231, 185, 140, 210, 48, 110, 237, 179, 81, 15, 78, 16, 242, 172, 47, 113, 147, 205, 17, 79, 173, 243, 112, 46, 
    204, 146, 211, 141, 111, 49, 178, 236, 14, 80, 175, 241, 19, 77, 206, 144, 114, 44, 109, 51, 209, 143, 12, 82, 176, 
    238, 50, 108, 142, 208, 83, 13, 239, 177, 240, 174, 76, 18, 145, 207, 45, 115, 202, 148, 118, 40, 171, 245, 23, 73, 
    8, 86, 180, 234, 105, 55, 213, 139, 87, 9, 235, 181, 54, 104, 138, 212, 149, 203, 41, 119, 244, 170, 72, 22, 233, 
    183, 85, 11, 136, 214, 52, 106, 43, 117, 151, 201, 74, 20, 246, 168, 116, 42, 200, 150, 21, 75, 169, 247, 182, 232, 
    10, 84, 215, 137, 107, 53
};


/****************************************************************************** 
 * Name:    CRC-8               x8+x2+x+1 
 * Poly:    0x07 
 * Init:    0x00 
 * Refin:   False 
 * Refout:  False 
 * Xorout:  0x00 
 * Note:    使用逐次计算法
 *****************************************************************************/  
uint8_t crc8(uint8_t *data, uint32_t length)  
{  
    uint8_t i;  
    uint8_t crc = 0;                            // Initial value  
    while(length--)  
    {  
        crc ^= *data++;                         // crc ^= *data; data++;  
        for ( i = 0; i < 8; i++ )  
        {  
            if ( crc & 0x80 )  
                crc = (crc << 1) ^ 0x07;  
            else  
                crc <<= 1;  
        }  
    }  
    return crc;  
}


/****************************************************************************** 
 * Name:    CRC-8               x8+x2+x+1 
 * Poly:    0x07 
 * Init:    0x00 
 * Refin:   False 
 * Refout:  False 
 * Xorout:  0x00 
 * Note:    使用查表法，提高运算效率，但表格占用一定的存储空间
 *****************************************************************************/  
uint8_t crc8_lut(uint8_t *data, uint32_t length)  
{  
    uint8_t crc = 0;                            // Initial value  
    while(length--)  
    {  
        crc = crc8Xor0x07Table[crc ^ *data++];  // crc ^= *data; data++;
    }  
    return crc;  
}
 

/****************************************************************************** 
 * Name:    CRC-8/ITU           x8+x2+x+1 
 * Poly:    0x07 
 * Init:    0x00 
 * Refin:   False 
 * Refout:  False 
 * Xorout:  0x55 
 * Alias:   CRC-8/ATM
 * Note:    使用逐次计算法
 *****************************************************************************/  
uint8_t crc8_itu(uint8_t *data, uint32_t length)  
{  
    uint8_t i;  
    uint8_t crc = 0;                            // Initial value  
    while(length--)  
    {  
        crc ^= *data++;                         // crc ^= *data; data++;  
        for ( i = 0; i < 8; i++ )  
        {  
            if ( crc & 0x80 )  
                crc = (crc << 1) ^ 0x07;  
            else  
                crc <<= 1;  
        }  
    }  
    return crc ^ 0x55;  
} 


/****************************************************************************** 
 * Name:    CRC-8/ITU           x8+x2+x+1 
 * Poly:    0x07 
 * Init:    0x00 
 * Refin:   False 
 * Refout:  False 
 * Xorout:  0x55 
 * Alias:   CRC-8/ATM
 * Note:    使用查表法，提高运算效率，但表格占用一定的存储空间
 *****************************************************************************/  
uint8_t crc8_itu_lut(uint8_t *data, uint32_t length)  
{  
    uint8_t crc = 0;                            // Initial value  
    while(length--)  
    {  
        crc = crc8Xor0x07Table[crc ^ *data++];  // crc ^= *data; data++;
    }  
    return crc ^ 0x55;  
}


/****************************************************************************** 
 * Name:    CRC-8/ROHC          x8+x2+x+1 
 * Poly:    0x07 
 * Init:    0xFF 
 * Refin:   True 
 * Refout:  True 
 * Xorout:  0x00 
 * Note:    使用逐次计算法
 *****************************************************************************/ 
uint8_t crc8_rohc(uint8_t *data, uint32_t length)  
{  
    uint8_t i;  
    uint8_t crc = 0xFF;                         // Initial value  
    while(length--)  
    {  
        crc ^= *data++;                         // crc ^= *data; data++;  
        for (i = 0; i < 8; ++i)  
        {  
            if (crc & 1)  
                crc = (crc >> 1) ^ 0xE0;        // 0xE0 = reverse 0x07  
            else  
                crc >>= 1;  
        }  
    }  
    return crc;  
}  


/****************************************************************************** 
 * Name:    CRC-8/ROHC          x8+x2+x+1 
 * Poly:    0x07 
 * Init:    0xFF 
 * Refin:   True 
 * Refout:  True 
 * Xorout:  0x00 
 * Note:    使用查表法，提高运算效率，但表格占用一定的存储空间
 *****************************************************************************/
uint8_t crc8_rohc_lut(uint8_t *data, uint32_t length)  
{   
    uint8_t crc = 0xFF;                         // Initial value  
    while(length--)
    {  
        crc = crc8Xor0xe0Table[crc ^ *data++];  // crc ^= *data; data++;
    }  
    return crc;  
}


/****************************************************************************** 
 * Name:    CRC-8/MAXIM         x8+x5+x4+1 
 * Poly:    0x31 
 * Init:    0x00 
 * Refin:   True 
 * Refout:  True 
 * Xorout:  0x00 
 * Alias:   DOW-CRC,CRC-8/IBUTTON 
 * Use:     Maxim(Dallas)'s some devices,e.g. DS18B20
 * Note:    使用逐次计算法
 *****************************************************************************/  
uint8_t crc8_maxim(uint8_t *data, uint32_t length)  
{  
    uint8_t i;  
    uint8_t crc = 0;                            // Initial value  
    while(length--)  
    {  
        crc ^= *data++;                         // crc ^= *data; data++;  
        for (i = 0; i < 8; i++)  
        {  
            if (crc & 1)  
                crc = (crc >> 1) ^ 0x8C;        // 0x8C = reverse 0x31  
            else  
                crc >>= 1;  
        }  
    }  
    return crc;  
}


/****************************************************************************** 
 * Name:    CRC-8/MAXIM         x8+x5+x4+1 
 * Poly:    0x31 
 * Init:    0x00 
 * Refin:   True 
 * Refout:  True 
 * Xorout:  0x00 
 * Alias:   DOW-CRC,CRC-8/IBUTTON 
 * Use:     Maxim(Dallas)'s some devices,e.g. DS18B20
 * Note:    使用查表法，提高运算效率，但表格占用一定的存储空间
 *****************************************************************************/  
uint8_t crc8_maxim_lut(uint8_t *data, uint32_t length)  
{  
    uint8_t crc = 0;                            // Initial value  
    while(length--)  
    {  
        crc = crc8Xor0x8cTable[crc ^ *data++];  // crc ^= *data; data++;
    }  
    return crc;  
}


/******************** (C) COPYRIGHT 广东宝乐机器人股份有限公司 *****END OF FILE**********************/
